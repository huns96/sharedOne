<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.sharedOne.mapper.report.ReportMapper">

<!--    <select id="selectOrders" parameterType="map" resultType="com.example.sharedOne.domain.report.OrderDto">-->
    <select id="selectOrders"  resultType="com.example.sharedOne.domain.report.OrderDto">
        SELECT * FROM order_header h left join order_item i on h.order_code=i.order_code

        <where>

<!--        <trim prefix="WHERE" prefixOverrides="and">-->
            <trim prefixOverrides="and">

                <if test="order_code != null and order_code!=''">
                    and h.order_code = #{order_code}
                </if>

                <if test="buyer_code != null and buyer_code!=''">
                    and h.buyer_code = #{buyer_code}
                </if>
                <if test="status != null and status!=''">
                    and h.status = #{status}
                </if>
                <if test="adduser != null and adduser!=''">
                    and h.adduser = #{adduser}
                </if>

                <if test="from_add_date != null and from_add_date!='' and to_add_date != null and to_add_date!=''">
                and h.adddate BETWEEN #{from_add_date} AND #{to_add_date}
                </if>
                <if test="product_code != null and product_code!=''">
                    and i.product_code=#{product_code}
                </if>
     </trim>
        </where>
        ORDER BY h.adddate DESC
    </select>


<select id="getSums" resultType="com.example.sharedOne.domain.report.SumDto">
    select  sum(quantity) sumQuantity,sum(price) sumPrice
    from  order_header h left join order_item i on h.order_code=i.order_code
    <where>

    <!--        <trim prefix="WHERE" prefixOverrides="and">-->
    <trim prefixOverrides="and">

    <if test="order_code != null and order_code!=''">
        and h.order_code = #{order_code}
    </if>

    <if test="buyer_code != null and buyer_code!=''">
        and h.buyer_code = #{buyer_code}
    </if>
    <if test="status != null and status!=''">
        and h.status = #{status}
    </if>
    <if test="adduser != null and adduser!=''">
        and h.adduser = #{adduser}
    </if>

    <if test="from_add_date != null and from_add_date!='' and to_add_date != null and to_add_date!=''">
        and h.adddate BETWEEN #{from_add_date} AND #{to_add_date}
    </if>
    <if test="product_code != null and product_code!=''">
        and i.product_code=#{product_code}
    </if>
    </trim>
    </where>

</select>


<select id="searchOrderCode" resultType="String">
    select order_code from order_header where order_code like #{order_code_part}
</select>


<select id="getOrderItems" resultType="com.example.sharedOne.domain.report.OrderItemDto">
    select * from order_item where order_code=#{order_code}
</select>








<!--    <select id="list" resultType="com.study.domain.board.BoardDto">-->
<!--        SELECT-->
<!--        b.id,-->
<!--        b.title,-->
<!--        b.writer,-->
<!--        b.inserted,-->
<!--        COUNT(DISTINCT r.id) countReply,-->
<!--        COUNT(DISTINCT f.id) countFile,-->
<!--        COUNT(DISTINCT l.memberId) countLike-->
<!--        FROM Board b LEFT JOIN Reply r ON b.id = r.boardId-->
<!--        LEFT JOIN File f ON b.id = f.boardId-->
<!--        LEFT JOIN BoardLike l ON b.id = l.boardId-->
<!--        WHERE-->

<!--        <trim prefixOverrides="OR">-->
<!--            <if test="type == 'all' or type == 'title'">-->
<!--                OR b.title LIKE #{keyword}-->
<!--            </if>-->

<!--            <if test="type == 'all' or type == 'content'">-->
<!--                OR b.content LIKE #{keyword}-->
<!--            </if>-->

<!--            <if test="type == 'all' or type == 'writer'">-->
<!--                OR b.writer LIKE #{keyword}-->
<!--            </if>-->
<!--        </trim>-->
<!--        GROUP BY b.id-->
<!--        ORDER BY b.id DESC-->
<!--        LIMIT #{offset}, #{records}-->
<!--    </select>-->
</mapper>